"use strict";exports.id=128,exports.ids=[128],exports.modules={5523:(e,s,t)=>{t.d(s,{Y:()=>_});var a=t(60687),r=t(63772),i=t(27990),d=t(55629),l=t(70373),n=t(24934),o=t(77767),c=t(58869),m=t(84027),u=t(85814),f=t.n(u),h=t(43210),x=t(43649),p=t(40228),g=t(48730),b=t(97051),N=t(11860),j=t(59821),v=t(75535);let{db:y}=(0,t(80043).M)(),w=()=>{let{user:e}=(0,r.A)(),[s,t]=(0,h.useState)([]),[a,i]=(0,h.useState)(!0),[d,l]=(0,h.useState)(0);return(0,h.useEffect)(()=>{if(!e){t([]),l(0),i(!1);return}console.log("Setting up notification listeners for user:",e.uid);let s=new Date,a=new Date;a.setDate(s.getDate()+3);let r=(0,v.P)((0,v.Cs)(y,"subtasks"),(0,v._M)("assignedTo","==",e.uid)),d=(0,v.P)((0,v.Cs)(y,"tasks"),(0,v._M)("owner","==",e.uid)),n=(0,v.P)((0,v.Cs)(y,"tasks"),(0,v._M)("assignedTo","==",e.uid)),o=(0,v.aQ)(r,async e=>{console.log("Subtasks snapshot received:",e.docs.length,"documents");let r=[];for(let t of e.docs){let e={id:t.id,...t.data()},i=t.ref.parent.parent,d=i?.parent.parent;if(i&&d&&"done"!==e.status)try{let t=await (0,v.x7)(i),l=await (0,v.x7)(d);if(t.exists()&&l.exists()){let n=t.data(),o=l.data().name;if(n.dueDate){let t=n.dueDate.toDate();if(console.log("Checking subtask due date:",e.title,"due:",t,"threshold:",a),t<=a){let a=t<s;console.log("Adding subtask notification:",e.title,"isOverdue:",a),r.push({id:`subtask_due_${e.id}`,type:"subtask_due",title:a?"Overdue Task":"Task Due Soon",message:`"${e.title}" in "${n.title}" is ${a?"overdue":"due soon"}`,boardId:d.id,boardName:o,taskId:i.id,taskTitle:n.title,subtaskId:e.id,subtaskTitle:e.title,dueDate:t,createdAt:new Date,isRead:!1})}}}}catch(e){console.error("Error fetching task/board for subtask notification:",e)}}console.log("Generated subtask notifications:",r.length),t(e=>[...e.filter(e=>"task_due"===e.type),...r])},e=>{console.error("Error in subtasks snapshot listener:",e),i(!1)}),c=async(e,t)=>{console.log(`${t} tasks snapshot received:`,e.docs.length,"documents");let r=[];for(let i of e.docs){let e={id:i.id,...i.data()},d=i.ref.parent.parent;if(d&&"done"!==e.status&&e.dueDate)try{let i=await (0,v.x7)(d);if(i.exists()){let l=i.data().name,n=e.dueDate.toDate();if(console.log(`Checking ${t} task due date:`,e.title,"due:",n,"threshold:",a),n<=a){let a=n<s;console.log(`Adding ${t} task notification:`,e.title,"isOverdue:",a),r.push({id:`task_due_${e.id}_${t}`,type:"task_due",title:a?"Overdue Task":"Task Due Soon",message:`"${e.title}" is ${a?"overdue":"due soon"}`,boardId:d.id,boardName:l,taskId:e.id,taskTitle:e.title,dueDate:n,createdAt:new Date,isRead:!1})}}}catch(e){console.error(`Error fetching board for ${t} task notification:`,e)}}return console.log(`Generated ${t} task notifications:`,r.length),r},m=(0,v.aQ)(d,async e=>{let s=await c(e,"owned");t(e=>[...e.filter(e=>!e.id.includes("_owned")),...s]),i(!1)},e=>{console.error("Error in owned tasks snapshot listener:",e),i(!1)}),u=(0,v.aQ)(n,async e=>{let s=await c(e,"assigned");t(e=>[...e.filter(e=>!e.id.includes("_assigned")),...s])},e=>{console.error("Error in assigned tasks snapshot listener:",e)});return()=>{o(),m(),u()}},[e]),(0,h.useEffect)(()=>{l(s.filter(e=>!e.isRead).length)},[s]),{notifications:s,unreadCount:d,loading:a,markAsRead:e=>{t(s=>s.map(s=>s.id===e?{...s,isRead:!0}:s))},markAllAsRead:()=>{t(e=>e.map(e=>({...e,isRead:!0})))},clearNotification:e=>{t(s=>s.filter(s=>s.id!==e))}}};var k=t(68834),A=t(20525),R=t(85650);let D=()=>{let{notifications:e,unreadCount:s,markAsRead:t,markAllAsRead:r,clearNotification:i}=w(),[l,o]=(0,h.useState)(!1),c=e=>{t(e.id),o(!1)},m=e=>(0,k.c)(e)?"Today":(0,A.e)(e)?"Tomorrow":(0,R.GP)(e,"MMM d"),u=(e,s)=>{if(s&&s<new Date)return(0,a.jsx)(x.A,{className:"h-4 w-4 text-red-500"});switch(e){case"task_due":case"subtask_due":return(0,a.jsx)(p.A,{className:"h-4 w-4 text-orange-500"});case"task_assigned":return(0,a.jsx)(g.A,{className:"h-4 w-4 text-blue-500"});default:return(0,a.jsx)(b.A,{className:"h-4 w-4 text-gray-500"})}},v=e.sort((e,s)=>e.isRead!==s.isRead?e.isRead?1:-1:e.dueDate&&s.dueDate?e.dueDate.getTime()-s.dueDate.getTime():s.createdAt.getTime()-e.createdAt.getTime());return(0,a.jsxs)(d.rI,{open:l,onOpenChange:o,children:[(0,a.jsx)(d.ty,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",className:"relative h-10 w-10 rounded-full hover:bg-gray-100",children:[(0,a.jsx)(b.A,{className:"h-5 w-5"}),s>0&&(0,a.jsx)(j.E,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:s>9?"9+":s})]})}),(0,a.jsxs)(d.SQ,{align:"end",className:"w-80 max-h-96 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border-b",children:[(0,a.jsx)("h3",{className:"font-semibold text-sm",children:"Notifications"}),s>0&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,className:"text-xs h-6 px-2",children:"Mark all read"})]}),0===e.length?(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)(b.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No notifications"})]}):(0,a.jsx)("div",{className:"max-h-80 overflow-y-auto",children:v.map(e=>(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(f(),{href:`/boards/${e.boardId}`,children:(0,a.jsx)(d._2,{className:`p-4 cursor-pointer border-b border-gray-100 hover:bg-gray-50 ${!e.isRead?"bg-blue-50/50":""}`,onClick:()=>c(e),children:(0,a.jsxs)("div",{className:"flex items-start gap-3 w-full",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:u(e.type,e.dueDate)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("p",{className:"font-medium text-sm truncate",children:e.title}),!e.isRead&&(0,a.jsx)("div",{className:"h-2 w-2 bg-blue-500 rounded-full flex-shrink-0"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.message}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:e.boardName}),e.dueDate&&(0,a.jsx)("span",{className:`${e.dueDate<new Date?"text-red-500 font-medium":"text-gray-500"}`,children:m(e.dueDate)})]})]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-gray-200",onClick:s=>{s.preventDefault(),s.stopPropagation(),i(e.id)},children:(0,a.jsx)(N.A,{className:"h-3 w-3"})})]})})})},e.id))}),(0,a.jsx)(d.mB,{}),(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(f(),{href:"/my-tasks",children:(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"w-full justify-center text-xs",onClick:()=>o(!1),children:"My Tasks"})})})]})]})},_=()=>{let{user:e,signOut:s}=(0,r.A)(),{userProfile:t}=(0,i.s)();return(0,a.jsxs)("header",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsx)(f(),{href:"/dashboard",children:(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Project Manager"})}),e&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",asChild:!0,className:"hidden sm:flex items-center gap-2 hover:bg-gray-100",children:(0,a.jsxs)(f(),{href:"/my-tasks",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),"My Tasks"]})}),(0,a.jsx)(D,{}),(0,a.jsxs)(d.rI,{children:[(0,a.jsx)(d.ty,{asChild:!0,children:(0,a.jsxs)(l.eu,{className:"cursor-pointer",children:[(0,a.jsx)(l.BK,{src:t?.photoURL||e.photoURL||void 0}),(0,a.jsx)(l.q5,{children:t?.displayName?t.displayName.charAt(0):e.displayName?e.displayName.charAt(0):e.email?.charAt(0)})]})}),(0,a.jsxs)(d.SQ,{align:"end",className:"w-56",children:[(0,a.jsxs)(d.lp,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),t?.displayName||e.displayName||e.email]}),(0,a.jsx)(d.mB,{}),(0,a.jsx)(f(),{href:"/dashboard",children:(0,a.jsxs)(d._2,{children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Dashboard"]})}),(0,a.jsx)(f(),{href:"/my-tasks",children:(0,a.jsxs)(d._2,{children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"My Tasks"]})}),(0,a.jsx)(f(),{href:"/profile",children:(0,a.jsxs)(d._2,{children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Profile Settings"]})}),(0,a.jsx)(d.mB,{}),(0,a.jsx)(d._2,{onSelect:s,className:"text-red-600 focus:text-red-600",children:"Log out"})]})]})]})]})}},6006:(e,s,t)=>{t.d(s,{q:()=>l});var a=t(60687),r=t(43210),i=t(63772),d=t(16189);let l=({children:e,fallback:s})=>{let{user:t,loading:l}=(0,i.A)(),n=(0,d.useRouter)();return((0,r.useEffect)(()=>{l||t||n.push("/login")},[t,l,n]),l)?s||(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):t?(0,a.jsx)(a.Fragment,{children:e}):null}},27990:(e,s,t)=>{t.d(s,{s:()=>l});var a=t(43210),r=t(75535),i=t(63772);let{db:d}=(0,t(80043).M)(),l=()=>{let{user:e}=(0,i.A)(),[s,t]=(0,a.useState)(null),[l,n]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{if(!e){t(null),n(!1);return}let s={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL},a=(0,r.H9)(d,"users",e.uid),i=(0,r.aQ)(a,e=>{if(e.exists()){let a=e.data();t({...s,displayName:a.displayName||s.displayName,photoURL:a.photoURL||s.photoURL,hasCustomPhoto:a.hasCustomPhoto||!1,photoUpdatedAt:a.photoUpdatedAt})}else t(s);n(!1)},e=>{console.error("Error fetching user profile:",e),t(s),n(!1)});return()=>i()},[e]),{userProfile:s,loading:l}}},55629:(e,s,t)=>{t.d(s,{SQ:()=>u,_2:()=>f,lp:()=>h,mB:()=>x,rI:()=>c,ty:()=>m});var a=t(60687),r=t(43210),i=t(29398),d=t(14952),l=t(13964),n=t(65822),o=t(96241);let c=i.bL,m=i.l9;i.YJ,i.ZL,i.Pb,i.z6,r.forwardRef(({className:e,inset:s,children:t,...r},l)=>(0,a.jsxs)(i.ZP,{ref:l,className:(0,o.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",e),...r,children:[t,(0,a.jsx)(d.A,{className:"ml-auto h-4 w-4"})]})).displayName=i.ZP.displayName,r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(i.G5,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})).displayName=i.G5.displayName;let u=r.forwardRef(({className:e,sideOffset:s=4,...t},r)=>(0,a.jsx)(i.ZL,{children:(0,a.jsx)(i.UC,{ref:r,sideOffset:s,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})}));u.displayName=i.UC.displayName;let f=r.forwardRef(({className:e,inset:s,...t},r)=>(0,a.jsx)(i.q7,{ref:r,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",e),...t}));f.displayName=i.q7.displayName,r.forwardRef(({className:e,children:s,checked:t,...r},d)=>(0,a.jsxs)(i.H_,{ref:d,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:t,...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(i.VF,{children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})}),s]})).displayName=i.H_.displayName,r.forwardRef(({className:e,children:s,...t},r)=>(0,a.jsxs)(i.hN,{ref:r,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(i.VF,{children:(0,a.jsx)(n.A,{className:"h-2 w-2 fill-current"})})}),s]})).displayName=i.hN.displayName;let h=r.forwardRef(({className:e,inset:s,...t},r)=>(0,a.jsx)(i.JU,{ref:r,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...t}));h.displayName=i.JU.displayName;let x=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(i.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",e),...s}));x.displayName=i.wv.displayName},59821:(e,s,t)=>{t.d(s,{E:()=>n});var a=t(60687);t(43210);var r=t(8730),i=t(24224),d=t(96241);let l=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:s,asChild:t=!1,...i}){let n=t?r.DX:"span";return(0,a.jsx)(n,{"data-slot":"badge",className:(0,d.cn)(l({variant:s}),e),...i})}},70373:(e,s,t)=>{t.d(s,{BK:()=>n,eu:()=>l,q5:()=>o});var a=t(60687),r=t(43210),i=t(11096),d=t(96241);let l=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(i.bL,{ref:t,className:(0,d.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));l.displayName=i.bL.displayName;let n=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(i._V,{ref:t,className:(0,d.cn)("aspect-square h-full w-full",e),...s}));n.displayName=i._V.displayName;let o=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(i.H4,{ref:t,className:(0,d.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));o.displayName=i.H4.displayName}};